"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery")):e(jQuery)}(function(b){var e=b(document),o="qor.publish2",i="enable."+o,s="click."+o,d="change."+o,t="qor.selectone.selected qor.selectone.unselected",n="added.qor.replicator.publish2",a="ShareableVersion",r=".qor-publish2__version",g="qor-table__inner-list",m="qor-table__inner-block",v="."+g,l=".qor-pulish2__eventid",c=".qor-pulish2__eventid-input",h=".qor-pulish2__action",u=".qor-pulish2__action-input",y="is-showing";function f(e,t){this.$element=b(e),this.options=b.extend({},f.DEFAULTS,b.isPlainObject(t)&&t),this.init()}return f.prototype={constructor:f,init:function(){this.actionType=this.options.element,this.bind(),this.initActionTemplate()},bind:function(){e.on(s,r,this.loadPublishVersion.bind(this)).on(d,u,this.action.bind(this)).on(t,l,this.eventidChanged.bind(this)).on(n,this.replicatorAdded.bind(this))},unbind:function(){e.off(s,r).off(d,u).off(t,l).off(n)},initActionTemplate:function(){b(h).closest(".qor-slideout").length||b(h).prependTo(b(".mdl-layout__content .qor-page__body form").first()).show(),f.initSharedVersion()},replicatorAdded:function(e,t){f.generateSharedVersionLabel(t)},action:function(e){var t=b(e.target),n="checkbox"==t.prop("type"),i=t.val(),o=b(this.actionType[t.data().actionType]),r=o.closest("label");o.length&&(n?(o.prop("checked",t.is(":checked")),t.is(":checked")?r.addClass("is-checked"):r.removeClass("is-checked")):o.val(i))},eventidChanged:function(e,t){t?b(c).val(t.primaryKey):b(c).val(""),this.updateDate(t,e.target),b(c).trigger("change")},updateDate:function(e,t){var n=b(t).closest(h),i=n.find(".qor-pulish2__action-start"),o=n.find(".qor-pulish2__action-end"),r=n.find(".qor-action__picker-button"),s=r.parent().find("input");e?(i.val(e.ScheduledStartAt),o.val(e.ScheduledEndAt),r.hide(),s.attr("disabled",!0)):(r.show(),s.attr("disabled",!1).closest(".is-disabled").removeClass("is-disabled")),i.trigger("change"),o.trigger("change")},loadPublishVersion:function(e){var t,n=b(e.target).parent("a"),i=n.data().versionUrl,o=n.closest("table"),r=n.closest("tr"),s=r.find("td").length,a=o.hasClass("qor-table--medialibrary"),d=b('<tr class="'+g+'"><td colspan="'+s+'"></td></tr>'),l=b('<div class="'+m+'"><div style="text-align: center;"><div class="mdl-spinner mdl-js-spinner is-active"></div></div></div>');if(r.hasClass(y))return b(v).remove(),o.find("tr").removeClass(y),!1;if(b(v).remove(),b("table tr").removeClass(y),r.addClass(y),a){var c=o.find(">tbody>tr"),h=parseInt(o.width()/217),u=c.index(r)+1,f=Math.ceil(c.length/h),p=Math.ceil(u/h);(r=b(c.get(h*p-1))).length||(r=c.last()),d=b('<tr class="'+g+'"><td></td></tr>'),1<f&&d.width(217*h-16)}return r.after(d),t=b(v).find("td"),l.appendTo(t).trigger("enable"),i&&b.get(i,function(e){b(".qor-table__inner-block").html(e).trigger("enable")}),!1},destroy:function(){this.unbind(),this.$element.removeData(o)}},f.generateSharedVersionLabel=function(e){var i,o=b('[name="shared-version-checkbox"]').html(),t=b('input[name$="'+a+'"]'),r={};e&&(t=e.find('input[name$="'+a+'"]')),t.each(function(){var e,t=b(this),n=t.closest(".qor-fieldset");n.hasClass("qor-fieldset--new")||(i=(Math.random()+1).toString(36).substring(7),r.id=[a,i].join("_"),(e=b(window.Mustache.render(o,r))).find("input").on(s,function(){b(this).is(":checked")?t.val("true"):t.val("")}),"true"==t.val()&&e.find("input").prop("checked",!0),e.prependTo(n).trigger("enable"),t.closest(".qor-field").hide())})},f.initSharedVersion=function(){b(h).length&&f.generateSharedVersionLabel()},b.fn.qorSliderAfterShow=b.fn.qorSliderAfterShow||{},b.fn.qorSliderAfterShow.initSharedVersion=f.initSharedVersion,b.fn.qorSliderAfterShow.initPublishForm=function(){var t,e=b(h),n=e.find("[data-action-type]"),i=b(".qor-slideout__body form.qor-form").first(),o=b(".qor-bottomsheets__body form"),r=e.closest(".qor-bottomsheets").length,s=e.closest(".qor-slideout").length,a=f.ELEMENT;e.length&&!i.data("takeover-publish")&&(o.length&&r?e.prependTo(o.first()):i.length&&s&&e.prependTo(i.first())),e.length&&n.length&&(s?t=b(".qor-slideout"):r&&(t=b(".qor-bottomsheets")),n.each(function(){var e=b(this);t.find(a[e.data("actionType")]).closest(".qor-form-section").hide()}),b(u).trigger(d))},f.DEFAULTS={},f.ELEMENT={scheduledstart:'[name="QorResource.ScheduledStartAt"]',scheduledend:'[name="QorResource.ScheduledEndAt"]',publishready:'[name="QorResource.PublishReady"]',versionname:'[name="QorResource.VersionName"]',eventid:'[name="QorResource.ScheduledEventID"]'},f.plugin=function(i){return this.each(function(){var e,t=b(this),n=t.data(o);if(!n){if(/destroy/.test(i))return;t.data(o,n=new f(this,i))}"string"==typeof i&&b.isFunction(e=n[i])&&e.apply(n)})},b(function(){var t=".qor-theme-publish2",n={};n.element=f.ELEMENT,b(document).on("disable.qor.publish2",function(e){f.plugin.call(b(t,e.target),"destroy")}).on(i,function(e){f.plugin.call(b(t,e.target),n)}).triggerHandler(i)}),f});